# Kubernetes and Logging #

(This draft is not fully functional yet. jonathan.johnson@dijure.com)

This scenario takes you through the basics of deploying a logging solution on Kubernetes. The premise is all the log streams generated by the containers are aggregated into a central datastore. From that datastore, queries and filters produce views from the aggregated logs.

Containers should only produce logs as event streams and leave the aggregation and routing to other services on Kubernetes. This pattern is emphasized as factor [11 Logs](https://12factor.net/logs) of the [The Twelve Factors App methodology](https://12factor.net/).

Commonly the three components ElasticSearch, Fluentd, and Kibana (EFK) are combined for the stack. Sometimes stack use Fluent bit instead of Fluentd. Fluent Bit is mostly functionally the same, but lighter in features and size. Other solutions sometimes use Logstash (ELK) instead of Fluentd.

This EFK stack solution uses the YAML files defined for the Minikube Addon called EFK. There are many ways to install a EFK stack and they vary in complexity. The preferred method is an EFK operator installed with a Helm chart.

## Aggregation: ElasticSearch ##

Elasticsearch is a search engine based on the Lucene library. It provides a distributed, multitenant-capable full-text search engine with an HTTP web interface and schema-free JSON documents.

## Forwarding: Fluentd ##

<img align="right" src="/javajon/courses/kubernetes-observability/logging/assets/docker_flow_flb_elastic.png">

[Fluentd](https://www.fluentd.org/) is an open source data collector, that lets you unify the data collection and consumption for a better use and understanding of data. In this stack Fluentd runs on each node (DaemonSet) and collects all the logs from /var/logs and routes them to ElasticSearch.

This example uses a lighter variation of Fluentd called [Fluent Bit](https://fluentbit.io/). Perhaps EfK, with a lower case 'f' is apropos. [Alen Komljen](https://akomljen.com/) covers the reason why in his [blog](https://akomljen.com/get-kubernetes-logs-with-efk-stack-in-5-minutes/).

Another variation for logging is the E**L**K stack that includes Logstash as a substitution for the Fluent aggregation solution.

## Viewing: Kibana ##

[Kibana](https://www.elastic.co/products/kibana) is an open source data visualization plugin for Elasticsearch. It provides visualization capabilities on top of the content indexed on an Elasticsearch cluster. Users can create bar, line and scatter plots, or pie charts and maps on top of large volumes of data.

For Kubernetes there are a wide variety of ways to assemble EFK together, especially with a production or business critical clusters. Some solutions may leverage an ElasticSearch service outside the cluster, perhaps offered by a cloud provider. For any solution that's deployed to Kubernetes it's recommended to use Helm charts. Even with Helm charts there are a variety of solutions evolving and competing with each other.

However, this scenario is aimed to show how you can get a working stack up with reasonable ease so you can see how the components are installed and work with each other.

In the following steps you will learn:

- How to deploy ElasticSearch, Fluent Bit, and Kibana with Helm charts
- How to generate log events and query then in Kibana
